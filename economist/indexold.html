<!doctype html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>The Economist</title>
  <link rel="stylesheet" type="text/css" href="../css/polaris.css">
	<link rel="stylesheet" type="text/css" href="css/search-form.css">
  <link rel="stylesheet" href="../font-awesome-4.4.0/css/font-awesome.min.css"  type="text/css">
  <link rel="icon" type="image/x-icon" class="js-site-favicon" href="../images/favicon.ico">
	<style type="text/css">
  #floatDiv{
  /*display:none;*/
  top:0;
  z-index:0;
  height:100%;
  width:100%;
  position:fixed;
  background-size: 100% 100%;
  background: #d4fff7;
  opacity: 0.8;
}

</style>
	<!--[if IE]>
		<script src="http://libs.baidu.com/html5shiv/3.7/html5shiv.min.js"></script>
	<![endif]-->
</head>
<body>
    <header>
        <h1 class="title"><img src="./img/econfinal_favicon.ico">The Economist</h1>
        <div class="row">

        <div class="col-six tab-full pull-right social">

            <ul class="links"> 
              <li><a href="javascript:void(0)" id="dictSetting"><i class="fa fa-gear"  style="font-size:30px;color:#00d0ff"></i></a></li>
              <li>&nbsp;</li>  
              <li><a href="https://lockeycheng.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li>     
             <li><a href="https://github.com/LockeyCheng" target="_blank"><i class="fa fa-github"></i></a></li>        
             <li><a href="https://blog.csdn.net/lockey23" target="_blank"><i class="fa fa-edit"></i></a></li>
             <li><a href="https://www.facebook.com/chen.yang.98031506"><i class="fa fa-facebook"></i></a></li>
             <li><a href="#"><i class="fa fa-twitter"></i></a></li>
             <li><a href="#"><i class="fa fa-google-plus"></i></a></li>   
           </ul> 
      </div>
      </div>
    </header>
	<section class="container">
		<div id="searchForm">
            <div class="search-wrapper">
                <div class="input-holder">
                    <input type="text" class="search-input" placeholder="Type to search" />
                    <button class="search-icon" onclick="searchToggle(this, event);"><span id="submitGo"></span></button>
                    <i class="fa fa-">
                </div>
                <span class="close" onclick="searchToggle(this, event);"></span>
                <div id="wordItems"  class="dictsChoose">
                  <ul class="list" id="wordItemChoose">
                    <li style="margin-left: -23px;">
                      <input type="checkbox" id="polaris-checkbox-checked-worditem"  name='economist' value='economist'>
                      <label for="polaris-checkbox-disabled-checked">Model sentence</label>
                    </li>
                  </ul>
                </div>
                <div class="result-container">

                </div>
                
            </div>
        </div>
	</section>
    
    <div class="searchResult">
        <div>
            <p class="wordName">tragedy</p>
            <p><span class="wordTitle">发音：</span><span class="pronEg"></span> <span class="pronAm"></span></span></p>
            <p><span class="wordTitle">释义：</span></p>
            <p><ul id="wordExplanationCN"></ul></p>
            <!-- <p><span class="wordTitle">释义（英）：</span><span class="wordExplanationEG"></span></p> -->
            <!-- <p><span class="wordTitle">变形：</span><span class="wordRelations"></span></p>
            <p><span class="wordTitle">近义：</span><span class="similar"></span></p>
            <p><span class="wordTitle">反义：</span><span class="reverse"></span></p> -->
            <div id="centences">
              
            </div>
        </div>
    </div>
    <div class="everydayMotto with_motto_footer" id="everydayMotto">
        <p class="todayMotto"></p>
        <p class="todayMottoAuthor"></p>
        <p class="todayMottoCn"></p>
    </div>
    <div class="everydayMotto dictsChoose" id="radioChoice">
        <ul class="list" id="dictChoice">
              <li>
                <input type="checkbox" id="polaris-checkbox-disabled-checked"  name='economist' value='economist' checked disabled>
                <label for="polaris-checkbox-disabled-checked">The Economist</label>
              </li>
              <li class="cet-li">
                <input type="checkbox" id="polaris-checkbox-2" value="cet4">
                <label for="polaris-checkbox-2">CET-4</label>
              </li>
              <li class="cet-li">
                <input type="checkbox" id="polaris-checkbox-3" value="cet6">
                <label for="polaris-checkbox-3">CET-6</label>
              </li>
          </ul>
            <div id="load_cancel">
            <input type="radio" id="polaris-radio-2" name="polaris-radio-dict-choice" value='load'>Load
            <input type="radio" id="polaris-radio-2" name="polaris-radio-dict-choice" value='cancel'>Cancel
          </div>
    </div>
    <footer class="with_motto_footer">
    <div class="row">
      <div class="col-six tab-full">
        <div class="copyright">
                <span><p class="time"></p></span>
                <span>Copyright @ 2017-2018 Created by Lockey All rights reserved.<a target="_blank" href="https://lockeycheng.github.io">www.lockey.io</a></span> 
        </div>                       
      </div>
    </div>
</footer>  
<div id="floatDiv">
  <div><h5 align="right"  id="closeFloat"><i class="fa fa-arrows-alt" style="font-size:2em;margin-right: 13px;margin-top:-5px"></i></h6></div>
  <div id="loadtips"><h3 align="center"><i class="fa fa-spinner"></i></h3><h3 align="center" id="loadWords"></h3></div>
</div>
	<script src="../js/jquery-2.1.1.js"></script>
  <script src="../js/icheck.min.js"></script>
	<script type="text/javascript">
        var youdaoSentenceAudio = 'https://dict.youdao.com/dictvoice?audio='//+sentence+&le=eng
        var youdaoWordAudio = 'https://dict.youdao.com/dictvoice?audio='//+criteria&type=2 or type=1
        var testAlpha = /^[a-zA-Z]+$/i
        var dictData={}
        var type2Dict={
          'economist_basic':'The Economist Dict ',
          'cet4_basic':'CET-4 Dict ',
          'cet6_basic':'CET-6 Dict ',
          'economist_model':'The Economist Model ',
          'cet4_model':'CET-4 Model ',
          'cet6_model':'CET-6 Model '
        }
        function getData(type){
          var toDict = type2Dict[type]
          $('#loadWords').html('Loading '+toDict)
          $('#floatDiv').fadeIn(456)
          var baseUrl = './explanations/'
          var getUrl = baseUrl+type+'.json'
          $.ajax({
                type:"GET",
                url: getUrl,
                data: null,
                dataType:'json',
                cache:false,
                success: function(data) {
                    dictData[type] = data
                    $('#loadWords').html(toDict+'loaded!')
                    $('#floatDiv').fadeOut(556)
                },
                error: function(data) {
                    $('#loadWords').html(toDict+'failed to load!')
                }
            });
        }
        getData('economist_basic')
        var searchDiv = $('#searchForm')
        function getAudio(arr){
            var y = arr.split(' ')
            var tmp = []
            for(var i in y){
              if(i!=''){
                var item = y[i]
                if(item == ','){item = '%2C'}
                if(item == '?'){item = '%3F'}
                tmp.push(y[i])
              }
            }
            out = tmp.join('+')
            return youdaoSentenceAudio+out
        }
        function searchToggle(obj, evt){
            var container = $(obj).closest('.search-wrapper');

            if(!container.hasClass('active')){
                  container.addClass('active');
                  evt.preventDefault();
                   $('.with_motto_footer').hide()
                  $('.search-input').focus()
                  $('.dictsChoose').show()
            }
            else if(container.hasClass('active') && $(obj).closest('.input-holder').length == 0){
                  container.removeClass('active');
                  // clear input
                  container.find('.search-input').val('');
                  // clear and hide result container when we press close
                  container.find('.result-container').fadeOut(100, function(){$(this).empty();});
                  $('.dictsChoose').hide()
                  $('.with_motto_footer').show()
                  $('.searchResult').hide()

            }
        }
        setInterval(
          function welcome(){
          var timeNow = Date()
          var timeSplit = timeNow.split(" ")
          var hms = timeSplit[4]
          var timeStr = timeSplit[0]+" "+timeSplit[1]+" "+ timeSplit[2]+" "+timeSplit[3]+" "+hms
          $('.time').html(timeStr)
        },1000)
        $('.todayMotto').html("I am not afraid of tomorrow for I have seen yesterday and I love today.")
        $('.todayMottoAuthor').html("- William Allen White")
        $('.todayMottoCn').html("我并不害怕明天，因为我已见过昨天并且热爱今天。")
        function submitSearch(){
                $('.dictsChoose').hide()
                var value = $(searchDiv).find('.search-input').val().trim();
                
                if(!value.length){
                    _html = "Yup yup! Add some text friend :D";
                    $(searchDiv).find('.result-container').html('<span>' + _html + '</span>');
                    return false
                }
                if(!testAlpha.test(value)){
                    $(searchDiv).find('.result-container').html('<span class="error">[' + value + ']</span> Illegal input, must be English word!');
                    $(searchDiv).find('.result-container').show()
                    return false
                }
                value = value.toLocaleLowerCase()
                var jsonData = dictData['economist_basic']
                if(!jsonData[value] && dictData['cet4_basic']){
                    jsonData = dictData['cet4_basic'].responseJSON
                }
                if(!jsonData[value] && dictData['cet6_basic']){
                    jsonData = dictData['cet6_basic'].responseJSON
                }
                $('#everydayMotto').hide()
                if(jsonData[value]){
                    $(searchDiv).find('.result-container').html('')
                    $('.wordName').text(value)
                    $('.pronEg').html('英'+jsonData[value]['pron']['peg'])
                    $('.pronAm').html('美'+jsonData[value]['pron']['pam'])
                    exLi = ''
                    exArr = jsonData[value]['ex']
                    for(var i in exArr){
                        exLi += '<li>'+exArr[i]+'</li>'
                    }
                    $('#wordExplanationCN').html(exLi)
                    if(jsonData[value]['eg2'] != []){
                        var toFillSentence = ''
                        var example = jsonData[value]['eg2']
                         for(var i in example){
                          var nu = i*1+1
                          toFillSentence += '<p><span class="wordTitle">例句'+nu+'：</span><span class="wordSentenceEn">'+example[i][0]+'</span></p><p><span class="wordTitle">例译：</span><span class="wordSentenceCn">'+example[i][1]+'</span></p>'
                         }
                         $('#centences').html(toFillSentence)
                    }
                    $('.everydayMotto').hide()
                    $('footer').hide()
                    $('.searchResult').show()
                }else{
                    $(searchDiv).find('.result-container').html('<span class="error">' + value + '</span> meets 404. May switch dictionary!');
                    setTimeout(function(){
                      $('#dictSetting').trigger('click')
                    },2190)
                    
                }
                $(searchDiv).find('.result-container').fadeIn(100);
                return false
        }
        $('#submitGo').click(function(){
                submitSearch()
        })
        document.onkeydown=function(event){
            var e = event || window.event || arguments.callee.caller.arguments[0];
            var value = $(searchDiv).find('.search-input').val().trim();
            if(e && e.keyCode == 13 && value.length){
                submitSearch()
            }
            }; 
            /*
        $('input').iCheck({
          checkboxClass: 'icheckbox_polaris',
          radioClass: 'iradio_polaris',
          increaseArea: '-10%' // optional
        });
        */
        $('#dictSetting').click(function(){
          $('.searchResult').hide()
          $('.everydayMotto').hide()
          $('.dictsChoose').show()
          $('.result-container').hide(334)
        })
        /*
        $('input').on('ifChanged', function(){
          var value = $(this).val()
          if(value == 'load'){
              $('#dictChoice').find('li').each(function(){
                if($(this).find('.icheckbox_polaris').hasClass('checked')){
                  var dict = $(this).find('.icheckbox_polaris').find('input').val()
                  if(dict == 'cet4'){
                    getData('cet4_basic')
                  }
                  if(dict == 'cet6'){
                     getData('cet6_basic')
                  }
                }
              })
          }
          else if(value == 'cancel'){
            $('.dictsChoose').hide()
            $('#everydayMotto').show()
             $('footer').show()
            $('input').iCheck('uncheck');
          }else{
            $('input[name="polaris-radio-dict-choice"]').iCheck('uncheck'); 
          }
        });
*/
        $('#closeFloat').click(function(){
            $('#floatDiv').fadeOut(556)
        })
    </script>
</body>
</html>